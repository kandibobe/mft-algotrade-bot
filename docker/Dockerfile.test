# ==============================================================================
# Stoic Citadel - Test Container
# ==============================================================================
# Lightweight container optimized for running tests
# ==============================================================================

FROM python:3.14-slim

# Set working directory
WORKDIR /app

# Install system dependencies for TA-Lib
RUN apt-get update && apt-get install -y \
    wget \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Install TA-Lib
RUN wget http://prdownloads.sourceforge.net/ta-lib/ta-lib-0.4.0-src.tar.gz && \
    tar -xzf ta-lib-0.4.0-src.tar.gz && \
    cd ta-lib/ && \
    ./configure --prefix=/usr && \
    make && \
    make install && \
    cd .. && \
    rm -rf ta-lib ta-lib-0.4.0-src.tar.gz

# Install Python dependencies
COPY requirements-research.txt /tmp/
RUN pip install --no-cache-dir \
    pytest>=8.0.0 \
    pytest-cov>=4.1.0 \
    pytest-mock>=3.12.0 \
    pytest-asyncio>=0.23.0 \
    pytest-benchmark>=4.0.0 \
    pandas>=2.0.0 \
    numpy>=1.24.0 \
    TA-Lib>=0.4.28 \
    pandas-ta>=0.3.14b \
    freqtrade>=2024.11

# Set Python path
ENV PYTHONPATH=/app
ENV PYTHONUNBUFFERED=1

# Default command
CMD ["pytest", "--version"]
